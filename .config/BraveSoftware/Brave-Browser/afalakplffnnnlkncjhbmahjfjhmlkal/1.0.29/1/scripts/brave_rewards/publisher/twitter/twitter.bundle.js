!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return s}));const n=(e,t,r)=>{if(void 0===e||void 0===t||e.length<t.length)return"";const n=e.indexOf(t);if(-1===n)return"";const s=n+t.length,i=e.indexOf(r,s);let o="";return i!==s?o=-1!==i&&i>s||-1!==i?e.substring(s,i):e.substring(s):""===r&&(o=e.substring(s)),o},s=(e,t)=>{const r=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);if(r.length!==n.length)return!1;for(let n=0;n<r.length;n++){const s=r[n];if(e[s]!==t[s])return!1}return!0}},function(e,t,r){"use strict";r.r(t);const n=["authorization","x-csrf-token","x-guest-token"],s=/[; ]_twitter_sess=([^\s;]*)/;let i=null,o={};const a=e=>{if(!e)return null;const t=e.match(s);return t?unescape(t[1]):null};var l=r(0);const c=e=>e?"twitter#channel:"+e:"",u=(e,t)=>e?t?`https://twitter.com/intent/user?user_id=${t}&screen_name=${e}`:`https://twitter.com/${e}/`:"",d=(e,t)=>{if(!e)return null;if(!t)return e.getAttribute("data-tweet-id");const r=e.querySelector("a[href*='/status/']");if(!r||!r.href)return null;const n=r.href.match(/status\/(\d+)/);return!n||n.length<2?null:n[1]},p=["https://api.twitter.com/1.1/*"],m=["requestHeaders","extraHeaders"];let f=null,y=!1,g=!1,h=null,w={},b=!0;const v=e=>{switch(e){case"twitterTipsHoverText":return"Tip this tweet";case"twitterTipsIconLabel":return"Tip"}return""},x=(e,t)=>new Promise((r,n)=>{e&&t?0!==Object.keys(w).length?f?(f.postMessage({type:"OnAPIRequest",mediaType:"twitter",data:{name:e,url:t,init:{credentials:"include",headers:{...w},referrerPolicy:"no-referrer-when-downgrade",method:"GET",redirect:"follow"}}}),f.onMessage.addListener((function t(s){if(f){if(!s||!s.data)return f.onMessage.removeListener(t),void n(new Error("Invalid message"));if("OnAPIResponse"===s.type){if(!s.data.name||!s.data.response&&!s.data.error)return f.onMessage.removeListener(t),void n(new Error("Invalid message"));if(s.data.name===e)return f.onMessage.removeListener(t),s.data.error?void n(new Error(s.data.error)):void r(s.data.response)}}else n(new Error("Invalid port"))}))):n(new Error("Invalid port")):n(new Error("Missing credential headers")):n(new Error("Invalid parameters"))}),T=(e,t)=>e&&t?(async e=>{if(!e)return Promise.reject(new Error("Invalid parameters"));return x("GetTweetDetails","https://api.twitter.com/1.1/statuses/show.json?id="+e)})(t).then(e=>({user:{id:e.user.id_str,screenName:e.user.screen_name,fullName:e.user.name,favIconUrl:e.user.profile_image_url_https.replace("_normal","")},post:{id:t,timestamp:e.created_at,text:e.text}})).catch(e=>(console.error(`Failed to fetch tweet details for ${t}: ${e.message}`),Promise.reject(e))):Promise.reject(new Error("Invalid parameters")),_=e=>{if("Enter"!==e.key&&"Space"!==e.code)return;const t=e.target;if(!t)return;const r=t.shadowRoot;if(!r)return;const n=r.querySelector(".js-actionButton");n&&n.click()},P=(e,t,r)=>{const n=document.createElement("div");n.className="ProfileTweet-action js-tooltip action-brave-tip",n.style.display="inline-block",n.style.minWidth="80px",n.style.textAlign=r?"right":"start",n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("data-original-title",v("twitterTipsHoverText")),n.addEventListener("keydown",_);const s=document.createElement("button");s.className="ProfileTweet-actionButton u-textUserColorHover js-actionButton",s.style.background="transparent",s.style.border="0",s.style.color="#657786",s.style.cursor="pointer",s.style.display="inline-block",s.style.fontSize="16px",s.style.lineHeight="1",s.style.outline="0",s.style.padding="0 2px",s.style.position="relative",s.type="button",s.onclick=function(r){if(b)T(e,t).then(e=>{e&&N(e)}).catch(t=>{console.error(`Failed to fetch tweet metadata for ${e}:`,t)});else{const r=((e,t)=>{if(!e)return null;const r=e.getElementsByClassName("tweet-text");if(!r||0===r.length)return null;const n=r[0],s=e.getElementsByClassName("js-short-timestamp");if(!s||0===s.length)return null;const i=s[0].getAttribute("data-time")||"";return{user:{id:e.getAttribute("data-user-id")||"",screenName:e.getAttribute("data-screen-name")||"",fullName:e.getAttribute("data-name")||"",favIconUrl:""},post:{id:t,timestamp:i,text:n.innerText||""}}})(e,t);r&&N(r)}r.stopPropagation()},b&&e&&(e=>{if(!e||!location.pathname.includes("/status/"))return!1;return!!e.querySelector("a[href*='how-to-tweet']")})(e)&&(s.style.marginTop="12px");const i=document.createElement("div");i.className="IconContainer js-tooltip",i.style.display="inline-block",i.style.lineHeight="0",i.style.position="relative",i.style.verticalAlign="middle",s.appendChild(i);const o=document.createElement("span");o.className="Icon Icon--medium",o.style.background="transparent",o.style.content='url(\'data:image/svg+xml;utf8,<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 105 100" style="enable-background:new 0 0 105 100;" xml:space="preserve"><style type="text/css">.st1{fill:%23662D91;}.st2{fill:%239E1F63;}.st3{fill:%23FF5000;}.st4{fill:%23FFFFFF;stroke:%23FF5000;stroke-width:0.83;stroke-miterlimit:10;}</style><title>BAT_icon</title><g id="Layer_2_1_"><g id="Layer_1-2"><polygon class="st1" points="94.8,82.6 47.4,55.4 0,82.9 "/><polygon class="st2" points="47.4,0 47.1,55.4 94.8,82.6 "/><polygon class="st3" points="0,82.9 47.2,55.9 47.4,0 "/><polygon class="st4" points="47.1,33.7 28,66.5 66.7,66.5 "/></g></g></svg>\')',o.style.display="inline-block",o.style.fontSize="18px",o.style.fontStyle="normal",o.style.height="16px",o.style.marginTop="5px",o.style.position="relative",o.style.verticalAlign="baseline",o.style.width="16px",i.appendChild(o);const a=document.createElement("span");a.className="ProfileTweet-actionCount",a.style.color="#657786",a.style.display="inline-block",a.style.fontSize="12px",a.style.fontWeight="bold",a.style.lineHeight="1",a.style.marginLeft="6px",a.style.position="relative",a.style.verticalAlign="text-bottom",s.appendChild(a);const l=document.createElement("span");l.className="ProfileTweet-actionCountForPresentation",l.textContent=v("twitterTipsIconLabel"),a.appendChild(l);const c=n.attachShadow({mode:"open"});c.appendChild(s);const u=document.createElement("style");return u.appendChild(document.createTextNode(".ProfileTweet-actionButton :hover { color: #FB542B }")),c.appendChild(u),n},E=()=>{clearTimeout(h),b=!0;let e=document.querySelectorAll('[role="article"]');0===e.length&&(e=document.querySelectorAll(".tweet"),b=!1);for(let t=0;t<e.length;++t){const r=d(e[t],b);if(!r)continue;let n;if(n=b?e[t].querySelector('[role="group"]'):e[t].querySelector(".js-actions"),!n)continue;if(0===n.getElementsByClassName("action-brave-tip").length){const s=(n.querySelectorAll(":scope > div").length||0)>3,i=P(e[t],r,s);n.appendChild(i)}}h=setTimeout(E,3e3)},S=(e,t)=>{if("twitter"!==e||!t||!t.requestHeaders)return;const r=(e=>{if(!e)return{};for(const t of e)if("Cookie"===t.name){const e=a(t.value);e!==i&&(i=e,o={})}else(n.includes(t.name)||t.name.startsWith("x-twitter-"))&&(o[t.name]=t.value);return o})(t.requestHeaders);l.a(r,w)||(w=r,k(),E())},j=()=>{g||(g=!0,f&&(f.postMessage({type:"RegisterOnUpdatedTab",mediaType:"twitter"}),f.onMessage.addListener((function(e){var t;if(e.data)switch(e.type){case"OnUpdatedTab":(t=e.data.changeInfo)&&t.url&&k()}}))))},I=e=>{const t=(e=>{const t=new URLSearchParams(e.search);if(!t)return"";const r=t.get("screen_name");if(r)return unescape(r);if(!e.pathname)return"";const n=e.pathname.split("/").filter(e=>e);return n&&0!==n.length?n[0]:""})(e);t&&(async e=>{if(!e)return Promise.reject(new Error("Invalid parameters"));return x("GetUserDetails","https://api.twitter.com/1.1/users/show.json?screen_name="+e)})(t).then(e=>{const r=e.id_str,n=c(r),s=t,i=e.profile_image_url_https.replace("_normal",""),o=u(t,r);f&&f.postMessage({type:"SavePublisherVisit",mediaType:"twitter",data:{url:o,publisherKey:n,publisherName:s,mediaKey:"",favIconUrl:i}})}).catch(e=>{console.error(`Failed to fetch user details for ${t}: ${e.message}`)})},k=()=>{const e=new URL(location.href);(e=>{if(["/","/about","/home","/login","/logout","/messages","/privacy","/search","/settings","/tos"].includes(e))return!0;const t=["/account/","/compose/","/explore","/hashtag/","/i/","/messages/","/notifications","/settings/","/who_to_follow/","/?login","/?logout"];for(const r of t)if(e.startsWith(r))return!0;return!1})(e.pathname)?f&&f.postMessage({type:"SavePublisherVisit",mediaType:"",data:{url:"https://twitter.com",publisherKey:"twitter.com",publisherName:"twitter.com",mediaKey:"",favIconUrl:""}}):I(e)},N=e=>{if(!e)return;const t=u(e.user.screenName,e.user.id),r=c(e.user.id),n=e.user.screenName;f&&f.postMessage({type:"TipUser",mediaType:"twitter",data:{url:t,publisherKey:r,publisherName:n,favIconUrl:e.user.favIconUrl,postId:e.post.id,postTimestamp:e.post.timestamp,postText:e.post.text}})};chrome.extension.inIncognitoContext||(f=chrome.runtime.connect("jidkidbbcafjabdphckchenhfomhnfma",{name:"Greaselion"}),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&(console.debug("visibilitychange event triggered"),k(),E())})),y||(y=!0,f&&(f.postMessage({type:"RegisterOnSendHeadersWebRequest",mediaType:"twitter",data:{urlPatterns:p,extra:m}}),f.onMessage.addListener((function(e){if(e.data)switch(e.type){case"OnSendHeadersWebRequest":S(e.mediaType,e.data.details)}})))),j(),console.info("Greaselion script loaded: twitter.ts"))}]);